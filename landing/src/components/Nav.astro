---
// src/components/Nav.astro
// Sticky liquid glass floating card navigation bar
// Mobile: shows logo + hamburger only. Desktop: full nav links + CTA
import MobileNav from './MobileNav.astro';

const pathname = Astro.url.pathname;

const links = [
  { href: '/features',   label: 'Funkcijos' },
  { href: '/pricing',    label: 'Kainodara' },
  { href: '/use-cases',  label: 'Naudojimo atvejai' },
  { href: '/docs',       label: 'Dokumentacija' },
  { href: '/forum',      label: 'Forumas' },
];

function isActive(href: string) {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href);
}
---
<header class="fixed top-0 left-0 right-0 z-50" style="padding: 0.75rem 1rem; pointer-events: none;">
  <div class="nav-card max-w-6xl mx-auto flex items-center justify-between"
       style="
         backdrop-filter: blur(40px) saturate(200%);
         -webkit-backdrop-filter: blur(40px) saturate(200%);
         background: linear-gradient(135deg, rgba(20,14,10,0.84) 0%, rgba(13,10,8,0.80) 100%);
         border: 1px solid rgba(245,158,11,0.14);
         border-radius: 1.25rem;
         box-shadow: 0 8px 32px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.05);
         pointer-events: auto;
         height: 56px;
         padding: 0 1.5rem;
       ">

    <!-- Logo -->
    <a href="/" class="flex items-center gap-2 shrink-0 nav-logo">
      <img src="/favicon.svg" alt="foxDoc logo" width="28" height="28" />
      <span class="font-heading text-lg font-bold text-white">fox<span style="color: #f59e0b;">Doc</span></span>
    </a>

    <!-- Desktop nav links -->
    <nav class="hidden md:flex items-center gap-1">
      {links.map(link => (
        <a
          href={link.href}
          class={`nav-link text-sm font-medium ${isActive(link.href) ? 'nav-link--active' : ''}`}
        >
          {link.label}
          {isActive(link.href) && <span class="nav-active-dot" aria-hidden="true" />}
        </a>
      ))}
    </nav>

    <!-- Desktop CTA + Mobile hamburger -->
    <div class="flex items-center gap-3">
      <a href="https://app.foxdoc.io/login"
         class="hidden md:block text-sm font-medium nav-link">
        Prisijungti
      </a>
      <a href="https://app.foxdoc.io"
         class="hidden md:inline-flex btn-primary">
        Išbandyti nemokamai
      </a>
      <MobileNav />
    </div>
  </div>
</header>

<!-- Sticky mobile CTA bar at bottom -->
<div class="fixed bottom-0 left-0 right-0 z-40 md:hidden px-4 pb-4 pt-2"
     style="background: rgba(26,21,18,0.97); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border-top: 1px solid rgba(168,162,158,0.10);">
  <a href="https://app.foxdoc.io" class="btn-primary w-full text-sm">
    Išbandyti nemokamai — nemokamai
  </a>
</div>

<style>
  /* Nav link base */
  .nav-link {
    position: relative;
    padding: 0.375rem 0.75rem;
    border-radius: 0.5rem;
    color: #7a6b61;
    text-decoration: none;
    transition: color 0.2s, background 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
  }

  /* Hover state */
  .nav-link:hover {
    color: #fdf9f7;
    background: rgba(245, 158, 11, 0.07);
  }

  /* Hover underline */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 3px;
    left: 0.75rem;
    right: 0.75rem;
    height: 1px;
    background: #f59e0b;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.25s ease;
  }
  .nav-link:hover::after {
    transform: scaleX(1);
  }

  /* Active state */
  .nav-link--active {
    color: #fdf9f7;
    background: rgba(245, 158, 11, 0.08);
  }
  .nav-link--active::after {
    transform: scaleX(1);
    background: rgba(245, 158, 11, 0.6);
  }

  /* Active dot indicator */
  .nav-active-dot {
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: #f59e0b;
    flex-shrink: 0;
    animation: dotPulse 2s ease-in-out infinite;
  }
  @keyframes dotPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* Logo hover */
  .nav-logo {
    transition: opacity 0.2s;
  }
  .nav-logo:hover {
    opacity: 0.85;
  }

  /* Scroll effect: card intensifies on scroll */
  .nav-card.scrolled {
    border-color: rgba(245, 158, 11, 0.22);
    box-shadow: 0 12px 40px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.06);
  }
</style>

<script>
  // Intensify card on scroll
  const navCard = document.querySelector('.nav-card');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 20) {
      navCard?.classList.add('scrolled');
    } else {
      navCard?.classList.remove('scrolled');
    }
  }, { passive: true });
</script>

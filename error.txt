NFO:     127.0.0.1:54980 - "POST /api/analyze HTTP/1.1" 202 Accepted
INFO:     127.0.0.1:57471 - "GET /api/analyze/j575386khea0m80940fatxj2px81nebd/stream HTTP/1.1" 200 OK
Streaming request failed (400), falling back to non-streaming
Streaming request failed (400), falling back to non-streaming
Streaming request failed (400), falling back to non-streaming
Streaming request failed (400), falling back to non-streaming
Streaming request failed (400), falling back to non-streaming
Streaming request failed (400), falling back to non-streaming
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Streaming extraction failed for 1124_6477383.pdf, retrying non-streaming: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Streaming extraction failed for 6477383_Skelbimas apie pirkimą - bendroji direktyva, įprasta tvarka_0.pdf, retrying non-streaming: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Streaming extraction failed for Specialiųjų pirkimo sąlygų 10 priedas.docx, retrying non-streaming: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Streaming extraction failed for Specialiosios pirkimo sąlygos.docx, retrying non-streaming: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Streaming extraction failed for espd-request.pdf, retrying non-streaming: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Streaming extraction failed for Bendrosios pirkimo sąlygos.docx, retrying non-streaming: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Extraction failed for 1124_6477383.pdf: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 308, in extract_document
    result, usage = await _extract_single(doc, llm, model, on_thinking=on_thinking)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 165, in _extract_single
    result, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 315, in extract_document
    result, usage = await _extract_single(
                    ^^^^^^^^^^^^^^^^^^^^^^
        doc, llm, model, on_thinking=on_thinking, use_streaming=False,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 175, in _extract_single
    result, usage = await llm.complete_structured(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Extraction failed for 6477383_Skelbimas apie pirkimą - bendroji direktyva, įprasta tvarka_0.pdf: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 308, in extract_document
    result, usage = await _extract_single(doc, llm, model, on_thinking=on_thinking)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 165, in _extract_single
    result, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 315, in extract_document
    result, usage = await _extract_single(
                    ^^^^^^^^^^^^^^^^^^^^^^
        doc, llm, model, on_thinking=on_thinking, use_streaming=False,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 175, in _extract_single
    result, usage = await llm.complete_structured(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Extraction failed for Specialiųjų pirkimo sąlygų 10 priedas.docx: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 308, in extract_document
    result, usage = await _extract_single(doc, llm, model, on_thinking=on_thinking)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 165, in _extract_single
    result, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 315, in extract_document
    result, usage = await _extract_single(
                    ^^^^^^^^^^^^^^^^^^^^^^
        doc, llm, model, on_thinking=on_thinking, use_streaming=False,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 175, in _extract_single
    result, usage = await llm.complete_structured(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Extraction failed for espd-request.pdf: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 308, in extract_document
    result, usage = await _extract_single(doc, llm, model, on_thinking=on_thinking)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 165, in _extract_single
    result, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 315, in extract_document
    result, usage = await _extract_single(
                    ^^^^^^^^^^^^^^^^^^^^^^
        doc, llm, model, on_thinking=on_thinking, use_streaming=False,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 175, in _extract_single
    result, usage = await llm.complete_structured(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Extraction failed for Specialiosios pirkimo sąlygos.docx: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 308, in extract_document
    result, usage = await _extract_single(doc, llm, model, on_thinking=on_thinking)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 165, in _extract_single
    result, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 315, in extract_document
    result, usage = await _extract_single(
                    ^^^^^^^^^^^^^^^^^^^^^^
        doc, llm, model, on_thinking=on_thinking, use_streaming=False,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 175, in _extract_single
    result, usage = await llm.complete_structured(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Extraction failed for Bendrosios pirkimo sąlygos.docx: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 308, in extract_document
    result, usage = await _extract_single(doc, llm, model, on_thinking=on_thinking)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 165, in _extract_single
    result, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 315, in extract_document
    result, usage = await _extract_single(
                    ^^^^^^^^^^^^^^^^^^^^^^
        doc, llm, model, on_thinking=on_thinking, use_streaming=False,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\extraction.py", line 175, in _extract_single
    result, usage = await llm.complete_structured(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'ExtractionResult': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Streaming request failed (400), falling back to non-streaming
Streaming structured completion failed (API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'AggregatedReport': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur), falling back to non-streaming
Pipeline failed for j575386khea0m80940fatxj2px81nebd: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'AggregatedReport': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 879, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'AggregatedReport': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\pipeline.py", line 209, in run
    report, agg_usage = await aggregate_results(
                        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\aggregation.py", line 140, in aggregate_results
    report, usage = await llm.complete_structured_streaming(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 981, in complete_structured_streaming
    return await self.complete_structured(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 717, in complete_structured
    response = await self._request_with_retry("POST", "/chat/completions", json=body)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nj\projects\procurement-analyzer\backend\app\services\llm.py", line 576, in _request_with_retry
    raise LLMError(
    ...<3 lines>...
    )
app.services.llm.LLMError: API error 400: {"error":{"message":"Provider returned error","code":400,"metadata":{"raw":"{\n  \"error\": {\n    \"message\": \"Invalid schema for response_format 'AggregatedReport': In context=('properties', 'evaluation_criteria', 'items'), 'required' is required to be supplied and to be an array including every key in properties. Missing 'weight_percent'.\",\n    \"type\": \"invalid_request_error\",\n    \"param\": \"text.format.schema\",\n    \"code\": \"invalid_json_schema\"\n  }\n}","provider_name":"Azur
